name: éªŒè¯åŸŸåç”³è¯·

on:
  pull_request:
    types: [opened, synchronize, reopened]
    paths:
      - 'domains/**/*.json'

jobs:
  validate-domain:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      actions: read
      pull-requests: read
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
        
      - name: è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
          
      - name: å®‰è£…ä¾èµ–
        run: pip install requests dnspython
        
      - name: è·å–æ›´æ”¹çš„æ–‡ä»¶
        id: changed-files
        uses: tj-actions/changed-files@v42
        with:
          files: 'domains/**/*.json'
          separator: ' '
      
      - name: éªŒè¯åŸŸåé…ç½®
        if: steps.changed-files.outputs.all_changed_files != ''
        run: |
          echo "=== å¼€å§‹éªŒè¯åŸŸåé…ç½® ==="
          echo "æ›´æ”¹çš„æ–‡ä»¶: ${{ steps.changed-files.outputs.all_changed_files }}"
          echo "PRä½œè€…: ${{ github.event.pull_request.user.login }}"
          echo ""
          
          # è¿è¡ŒéªŒè¯è„šæœ¬å¹¶ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ŒåŒ…å«æ‰€æœ‰æƒéªŒè¯
          if python scripts/bot/pr_checker.py \
            --files ${{ steps.changed-files.outputs.all_changed_files }} \
            --pr-author "${{ github.event.pull_request.user.login }}" \
            --repo-owner "${{ github.repository_owner }}" \
            --repo-name "${{ github.event.repository.name }}" \
            --github-token "${{ secrets.GITHUB_TOKEN }}" \
            --debug; then
            echo ""
            echo "ğŸ‰ æ‰€æœ‰åŸŸåé…ç½®éªŒè¯é€šè¿‡ï¼"
          else
            echo ""
            echo "âŒ åŸŸåé…ç½®éªŒè¯å¤±è´¥ï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚"
            exit 1
          fi
      
      - name: æ— æ–‡ä»¶æ›´æ”¹
        if: steps.changed-files.outputs.all_changed_files == ''
        run: |
          echo "â„¹ï¸ æ²¡æœ‰æ£€æµ‹åˆ°åŸŸåé…ç½®æ–‡ä»¶çš„æ›´æ”¹ã€‚"
